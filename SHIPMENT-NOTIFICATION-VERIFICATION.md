# 出貨通知系統修復驗證清單

## 修復日期
2026-02-03

## Git 提交記錄
- `253a282` feat(shipment): 出貨頁面新增客戶身分證字號顯示
- `aa720d3` feat(shipment): 新增物流方式與到貨日期欄位
- `25e8937` fix(export): 修正 Excel 報表欄位與順序
- `79e946d` fix(notification): 修正出貨通知資料來源邏輯

---

## ✅ 驗證項目

### 1. 出貨頁面 - 身分證字號顯示

**測試步驟：**
1. 開啟標記出貨頁面：`https://test.buygo.me/buygo-portal/shipment-details/?view=shipment-mark&id=72`
2. 檢查「客戶資訊」區塊

**預期結果：**
- [ ] 顯示「身分證字號」欄位（在電話欄位下方）
- [ ] 身分證字號使用等寬字體（font-mono）
- [ ] 如果客戶沒有身分證字號，不顯示該欄位

---

### 2. 出貨頁面 - 出貨設定欄位

**測試步驟：**
1. 開啟標記出貨頁面
2. 檢查「出貨設定」區塊

**預期結果：**
- [ ] **出貨時間**：顯示當前時間（格式：2026-02-03 18:18:35），唯讀，無法編輯
- [ ] **到貨時間**：日期選擇器，可手動選擇日期，最小日期為今天
- [ ] **物流方式**：下拉選單，包含以下選項：
  - [ ] 請選擇物流方式（預設）
  - [ ] 易利
  - [ ] 千森
  - [ ] OMI
  - [ ] 多賀
  - [ ] 賀來
  - [ ] 神奈川
  - [ ] 新日本
  - [ ] EMS

---

### 3. Excel 報表 - 欄位完整性與順序

**測試步驟：**
1. 勾選一個或多個出貨單
2. 點擊「匯出 Excel」按鈕
3. 下載並開啟 Excel 檔案
4. 檢查標題列和資料列

**預期結果：**

標題列順序（共 17 欄）：
1. [ ] 出貨單號
2. [ ] 客戶姓名
3. [ ] 客戶電話
4. [ ] 客戶地址
5. [ ] Email
6. [ ] 身分證字號
7. [ ] LINE 名稱
8. [ ] 商品名稱
9. [ ] 數量
10. [ ] 單價
11. [ ] 小計
12. [ ] 出貨日期
13. [ ] 到貨日期
14. [ ] 物流方式
15. [ ] 追蹤號碼
16. [ ] 狀態
17. [ ] 備註

**資料內容檢查：**
- [ ] LINE 名稱欄位有顯示內容（不是空白）
- [ ] 身分證字號欄位有顯示內容
- [ ] 到貨日期格式為 YYYY-MM-DD（例：2026-02-05）
- [ ] 物流方式顯示正確（例：易利、千森）
- [ ] 所有欄位對齊正確

---

### 4. LINE 出貨通知 - 訊息內容

**測試步驟：**
1. 建立一張測試出貨單（確保客戶有綁定 LINE）
2. 填寫「物流方式」和「到貨時間」
3. 點擊「確認出貨」按鈕
4. 等待 1 分鐘，檢查買家的 LINE 通知

**預期結果：**

LINE 訊息應包含：
```
您的訂單已出貨囉！

商品清單：
- [商品名稱] x [數量]
- [商品名稱] x [數量]

物流方式：[易利/千森/OMI 等]
預計送達：2026/02/05

感謝您的購買！如有問題請聯繫客服。
```

**檢查項目：**
- [ ] 訊息在 1 分鐘內送達
- [ ] 商品清單完整且格式正確
- [ ] 物流方式顯示正確（不是「標準配送」）
- [ ] 預計送達時間格式為 YYYY/MM/DD
- [ ] 如果沒有填寫物流方式，顯示「標準配送」
- [ ] 如果沒有填寫到貨時間，顯示「配送中」

---

## 🔍 已知限制

1. **LINE 名稱來源**：從 `wp_usermeta.buygo_line_display_name` 取得，如果該欄位為空，Excel 中 LINE 名稱欄位會顯示空白
2. **身分證字號來源**：從 `fct_order_meta.taiwan_id_number` 取得，客戶下單時若未填寫，該欄位會顯示空白
3. **通知延遲**：首次發送可能需要 10-30 秒，如果失敗會在 1 分鐘後重試

---

## ❌ 發現問題時

如果發現任何項目無法通過，請記錄：
1. 問題描述
2. 重現步驟
3. 截圖或錯誤訊息
4. 測試環境（瀏覽器、裝置）

然後回報給開發人員。

---

## ✅ 驗證完成

驗證人員：________________
驗證日期：________________
驗證結果：[ ] 通過 / [ ] 發現問題

備註：
