# Plan 23-01: GitHub 自動更新機制

```yaml
wave: 1
depends_on: []
files_modified:
  - buygo-plus-one.php
  - composer.json
  - composer.lock
autonomous: true
```

## Goal

整合 `yahnis-elsts/plugin-update-checker` 函式庫，實現從 GitHub Releases 自動更新外掛功能。

## Context

- 使用 `yahnis-elsts/plugin-update-checker` v5.x
- GitHub 倉庫：`fishtvlvoe/buygo-plus-one`
- 每 24 小時檢查一次更新
- WordPress 外掛頁面顯示更新通知
- 自動更新模式

## Tasks

### Task 1: 安裝 plugin-update-checker 函式庫

```xml
<bash>
cd /Users/fishtv/Development/buygo-plus-one-dev && composer require yahnis-elsts/plugin-update-checker
</bash>
```

**Expected:** composer.json 和 composer.lock 更新，vendor/ 目錄包含函式庫。

### Task 2: 在主外掛檔案中整合更新檢查器

在 `buygo-plus-one.php` 的適當位置加入更新檢查器初始化：

```xml
<edit file="buygo-plus-one.php">
<find>
// 在 plugins_loaded 之前或檔案末尾加入
</find>
<insert>
// GitHub 自動更新檢查
require 'vendor/autoload.php';
use YahnisElsts\PluginUpdateChecker\v5\PucFactory;

$myUpdateChecker = PucFactory::buildUpdateChecker(
    'https://github.com/fishtvlvoe/buygo-plus-one',
    __FILE__,
    'buygo-plus-one'
);

// 設定分支（可選，預設為 main）
$myUpdateChecker->setBranch('main');

// 啟用 GitHub Releases
$myUpdateChecker->getVcsApi()->enableReleaseAssets();
</insert>
</edit>
```

**Expected:** 外掛檔案包含更新檢查器初始化程式碼。

### Task 3: 測試更新檢查功能

```xml
<bash>
# 清除 WordPress transients 以強制檢查更新
wp transient delete --all --allow-root --path=/Users/fishtv/Local\ Sites/buygo/app/public 2>/dev/null || echo "手動測試：進入 WP 後台 → 外掛頁面"
</bash>
```

**手動驗證步驟:**
1. 進入 https://test.buygo.me/wp-admin/plugins.php
2. 檢查 BuyGo+1 是否顯示更新檢查資訊
3. 確認每 24 小時檢查一次的設定生效

## Verification Criteria

- [ ] composer.json 包含 `yahnis-elsts/plugin-update-checker` 依賴
- [ ] buygo-plus-one.php 正確初始化更新檢查器
- [ ] WordPress 外掛頁面能顯示更新通知（當 GitHub 有新 Release 時）
- [ ] 更新檢查不影響外掛正常運作
- [ ] 錯誤處理：GitHub API 失敗時不中斷外掛載入

## Must-Haves (Goal-Backward)

為了「實現從 GitHub Releases 自動更新」，必須：
1. ✓ plugin-update-checker 函式庫已安裝
2. ✓ 更新檢查器在外掛載入時正確初始化
3. ✓ GitHub 倉庫路徑正確指向 fishtvlvoe/buygo-plus-one
4. ✓ WordPress 能檢測並顯示可用更新

## Notes

- 參考研究文件：`.planning/research/GITHUB-UPDATER.md`
- GitHub API rate limit: 未認證 60 次/小時，已認證 5000 次/小時
- 如需私有倉庫，需要設定 GitHub Personal Access Token

---

*Plan: 23-01*
*Created: 2026-01-31*
