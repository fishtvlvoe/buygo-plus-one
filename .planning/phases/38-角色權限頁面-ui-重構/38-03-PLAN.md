---
phase: 38-角色權限頁面-ui-重構
plan: 03
type: execute
wave: 3
depends_on: [38-02]
files_modified:
  - includes/admin/class-settings-page.php
autonomous: true

must_haves:
  truths:
    - "商品限制欄位在所有賣家都可以編輯（無 disabled 狀態）"
    - "新賣家的預設商品限制為 3"
    - "輸入 0 表示無限制，顯示提示文字「（無限制）」"
  artifacts:
    - path: "includes/admin/class-settings-page.php"
      provides: "商品限制預設值和 UI 邏輯"
      contains: "product_limit = 3"
  key_links:
    - from: ".product-limit-input"
      to: "buygo_update_product_limit"
      via: "AJAX"
      pattern: "product-limit"
---

<objective>
商品限制邏輯統一：移除 disabled 限制，統一預設值為 3

Purpose: 讓所有賣家都能編輯商品限制，並將預設值從 2 改為 3
Output: 統一的商品限制編輯體驗
</objective>

<execution_context>
@/Users/fishtv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fishtv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/fishtv/Development/buygo-plus-one-dev/.planning/STATE.md
@/Users/fishtv/Development/buygo-plus-one-dev/.planning/ROADMAP.md
@/Users/fishtv/Development/buygo-plus-one-dev/.planning/REQUIREMENTS.md
@/Users/fishtv/Development/buygo-plus-one-dev/includes/admin/class-settings-page.php (lines 654-935)
</context>

<tasks>

<task type="auto">
  <name>Task 1: 修改預設商品限制為 3</name>
  <files>includes/admin/class-settings-page.php</files>
  <action>
在 `render_roles_tab()` 方法中修改預設值（約 line 724-728）：

找到：
```php
// 取得商品限制數量 (0 = 無限制)
$product_limit = get_user_meta($user->ID, 'buygo_product_limit', true);
if ($product_limit === '') {
    $product_limit = 2; // 預設為 2 個商品
}
```

改為：
```php
// 取得商品限制數量 (0 = 無限制)
$product_limit = get_user_meta($user->ID, 'buygo_product_limit', true);
if ($product_limit === '') {
    $product_limit = 3; // 預設為 3 個商品（v1.5 更新）
}
```
  </action>
  <verify>
```bash
cd /Users/fishtv/Development/buygo-plus-one-dev && grep -n "product_limit = 3" includes/admin/class-settings-page.php
```
  </verify>
  <done>新賣家的預設商品限制為 3</done>
</task>

<task type="auto">
  <name>Task 2: 移除 disabled 狀態和更新提示文字</name>
  <files>includes/admin/class-settings-page.php</files>
  <action>
在 `render_roles_tab()` 方法中修改商品限制欄位的 HTML。

**注意**：Plan 38-02 已經移除了「賣家類型」欄位，所以商品限制欄位的位置會往前移動。找到商品限制的 `<td>` 區塊（在「綁定關係」欄位之後）。

找到原本的程式碼（約 line 840-856，但位置可能已因 Plan 02 變動）：
```php
<td>
    <div style="display: flex; align-items: center; gap: 5px;">
        <input
            type="number"
            class="product-limit-input"
            data-user-id="<?php echo esc_attr($user['id']); ?>"
            value="<?php echo esc_attr($user['product_limit']); ?>"
            min="0"
            step="1"
            style="width: 60px; font-size: 12px;"
            <?php echo ($user['seller_type'] === 'real') ? 'disabled' : ''; ?>
        />
        <span style="font-size: 11px; color: #666;">
            <?php echo ($user['seller_type'] === 'real') ? '(無限制)' : '個商品'; ?>
        </span>
    </div>
</td>
```

改為（移除 disabled 邏輯，更新提示文字）：
```php
<td>
    <div style="display: flex; align-items: center; gap: 5px;">
        <input
            type="number"
            class="product-limit-input"
            data-user-id="<?php echo esc_attr($user['id']); ?>"
            value="<?php echo esc_attr($user['product_limit']); ?>"
            min="0"
            step="1"
            style="width: 60px; font-size: 12px;"
        />
        <span style="font-size: 11px; color: #666;">
            <?php echo ($user['product_limit'] == 0) ? '（無限制）' : '個商品'; ?>
        </span>
    </div>
</td>
```

**重要變更：**
1. 移除 `<?php echo ($user['seller_type'] === 'real') ? 'disabled' : ''; ?>` 這一行
2. 提示文字改為根據 `product_limit == 0` 判斷，而非 `seller_type`
  </action>
  <verify>
```bash
cd /Users/fishtv/Development/buygo-plus-one-dev && php -l includes/admin/class-settings-page.php
# 確認沒有 disabled 屬性與 product-limit 關聯
cd /Users/fishtv/Development/buygo-plus-one-dev && grep -A5 "product-limit-input" includes/admin/class-settings-page.php | grep -c "disabled"
# 應該返回 0
```
  </verify>
  <done>商品限制欄位對所有賣家都可編輯，提示文字根據數值顯示</done>
</task>

</tasks>

<verification>
1. PHP 語法檢查通過
2. 預設商品限制為 3
3. 商品限制輸入框對所有使用者都可編輯（無 disabled）
4. 提示文字正確：0 顯示「（無限制）」，其他數字顯示「個商品」
</verification>

<success_criteria>
- UI-05 完成：
  - 商品限制欄位在所有賣家都可以編輯
  - 預設值改為 3
  - 0 = 無限制
</success_criteria>

<output>
After completion, create `.planning/phases/38-角色權限頁面-ui-重構/38-03-SUMMARY.md`
</output>
