# Dashboard 和全域搜尋 - 使用者需求研究報告

**研究日期：** 2026-01-29
**研究範圍：** 每日覆盤文件（2025-12-26 至 2026-01-18）
**研究目的：** 找出 Dashboard 和全域搜尋的實際需求和使用情境

---

## 一、研究方法

### 資料來源
1. **每日覆盤文件**：`/Users/fishtv/Desktop/VT工作流/_Archive/舊項目/doc/0-每日覆盤/`
2. **現有程式碼**：
   - `class-global-search-api.php` - 已實作的全域搜尋 API
   - `smart-search-box.php` - 已實作的智慧搜尋元件
3. **專案文件**：
   - `STRUCTURE.md` - 專案結構分析
   - Phase 5 Spec 撰寫覆盤

### 研究關鍵字
- Dashboard / 儀表板 / 統計 / 報表 / 數據 / 圖表
- 搜尋 / 查詢 / 搜索 / 查找 / 篩選 / 過濾

---

## 二、關鍵發現

### 🎯 Dashboard 需求

#### 1. 基本需求（從覆盤文件提取）

**來源：Phase 5 Spec 撰寫覆盤（2026-01-06）**
- Portal UI 設計包含「儀表板」頁面
- 與 4 個管理頁面（產品、訂單、出貨、會員）並列的核心頁面
- 優先級：P0（必須完成的 Spec）

**來源：Phase 2 開發覆盤（2026-01-16）**
```
Best Case: 下午就能開始做儀表板
Possible Case: 明天重點會放在「讓數據變真實」
```
**解讀**：Dashboard 是在基礎資料整合完成後的下一步優先功能

**來源：小幫手測試計劃（2025-12-30）**
- 測試 Dashboard API：`/wp-json/buygo/v1/dashboard/stats`
- 需求：小幫手登入後，Dashboard 要能正確顯示綁定賣家的統計資料
- 權限檢查：Dashboard 資料要受權限控制（只看到自己管理的賣家資料）

#### 2. Dashboard 的實際業務需求

**沒有直接提到的需求（但從工作流程可推斷）**：

從訂單、商品、出貨管理的覆盤文件中可以看出：
- 賣家需要快速了解「今天要處理什麼」
- 訂單狀態變化需要即時掌握
- 庫存和採購數量需要監控
- 出貨進度需要追蹤

**推斷的 Dashboard 核心需求**：
1. **待辦事項概覽**
   - 待處理訂單數量
   - 待出貨訂單數量
   - 庫存不足的商品
   - 需要回覆的客戶訊息

2. **業務指標**
   - 今日/本週/本月訂單數量
   - 今日/本週/本月營業額
   - 商品總數 / 已上架 / 已下架
   - 客戶總數

3. **快速入口**
   - 直接跳轉到各管理頁面
   - 快速建立訂單/商品
   - 快速搜尋

### 🔍 全域搜尋需求

#### 1. 現有實作（已完成）

**檔案：** `class-global-search-api.php`

**已支援的搜尋範圍**：
- ✅ 商品（product）- 搜尋名稱、ID
- ✅ 訂單（order）- 搜尋訂單號、客戶名稱、ID
- ✅ 客戶（customer）- 搜尋姓名、Email、電話、ID
- ✅ 出貨單（shipment）- 搜尋出貨單號、客戶名稱、ID

**已實作的功能**：
- ✅ 跨模組搜尋（一次搜尋所有資料類型）
- ✅ 相關性排序（relevance_score）
- ✅ 結果限制（可設定最多顯示幾筆）
- ✅ 類型標籤（產品/訂單/客戶/出貨單）
- ✅ 直接跳轉連結（url 欄位）

**檔案：** `smart-search-box.php`

**已實作的 UI 功能**：
- ✅ 即時搜尋建議（輸入時自動載入）
- ✅ 最近項目顯示（空白時顯示最近使用）
- ✅ 類型徽章（顯示資料類型）
- ✅ 狀態標籤（顯示項目狀態）
- ✅ 圖片顯示（選擇性）
- ✅ 防抖處理（避免過度查詢）
- ✅ 幣別切換（選擇性，JPY/TWD）

#### 2. 實際使用情境（從覆盤文件推斷）

**情境 1：處理訂單時需要查詢**
- 客戶打電話詢問訂單狀態 → 需要快速搜尋訂單號
- 要修改訂單商品 → 需要搜尋商品名稱
- 要確認客戶資料 → 需要搜尋客戶姓名/電話

**情境 2：商品管理時需要查詢**
- 要編輯特定商品 → 搜尋商品名稱
- 要查看商品訂單數量 → 搜尋商品後查看詳情
- 要調整庫存 → 搜尋商品後進入編輯

**情境 3：出貨作業時需要查詢**
- 要建立出貨單 → 搜尋訂單
- 要查詢出貨進度 → 搜尋出貨單號
- 要確認客戶地址 → 搜尋客戶資料

**情境 4：小幫手使用時需要權限控制**
- 小幫手只能搜尋到自己管理的賣家資料
- 搜尋結果要自動過濾權限

---

## 三、現有實作狀態

### Dashboard（未實作）

**狀態：** ❌ 尚未開始
**檔案：** `admin/partials/dashboard.php` - 不存在
**API：** 無對應的 Dashboard API

**證據：**
- `STRUCTURE.md` 中提到 `dashboard.php (if exists)`
- Phase 2 覆盤中提到「下午就能開始做儀表板」，但實際未執行
- 小幫手測試計劃中提到 `/wp-json/buygo/v1/dashboard/stats`，但實際不存在

### 全域搜尋（已實作 80%）

**狀態：** ✅ 核心功能已完成
**檔案：**
- `includes/api/class-global-search-api.php` - 已完成
- `components/shared/smart-search-box.php` - 已完成

**已完成功能：**
- ✅ 跨模組搜尋 API
- ✅ 智慧搜尋元件
- ✅ 即時建議
- ✅ 類型徽章
- ✅ 狀態標籤

**待完成功能：**
- ⏳ 權限過濾（小幫手只能搜尋自己管理的賣家資料）
- ⏳ 搜尋歷史記錄
- ⏳ 熱門搜尋關鍵字
- ⏳ 進階篩選（日期範圍、狀態篩選等）

---

## 四、優先順序建議

### Phase 21: Dashboard（優先級 P0）

#### 必須完成（MVP）

**1. 統計卡片區**
```
┌────────────────┬────────────────┬────────────────┬────────────────┐
│ 今日訂單       │ 待處理訂單     │ 待出貨訂單     │ 商品總數       │
│ 15 筆          │ 8 筆           │ 5 筆           │ 234 個         │
│ +3 較昨日      │ 需要處理       │ 需要處理       │ 123 已上架     │
└────────────────┴────────────────┴────────────────┴────────────────┘
```

**資料來源：**
- 訂單資料：`wp_fct_orders` 表
- 商品資料：`wp_posts` (post_type='product')
- 出貨資料：`wp_fct_shipments` 表

**API 端點：** `/wp-json/buygo-plus-one/v1/dashboard/stats`

**2. 快速入口區**
```
┌─────────────────────────────────────────────────┐
│ 快速動作                                        │
│ [+ 新增訂單] [+ 新增商品] [📦 建立出貨單]      │
└─────────────────────────────────────────────────┘
```

**3. 待辦事項清單**
```
┌─────────────────────────────────────────────────┐
│ 需要處理的事項                                  │
│ • 訂單 #1234 - 待付款確認                      │
│ • 訂單 #1235 - 待出貨                          │
│ • 商品「XXX」庫存不足（剩餘 2 個）            │
└─────────────────────────────────────────────────┘
```

#### 可選完成（P1）

**4. 圖表區**
- 近 7 天訂單趨勢圖（折線圖）
- 商品銷售排行榜（橫條圖）
- 訂單狀態分布（圓餅圖）

**圖表庫建議：** Chart.js 或 ApexCharts

**5. 最近活動**
- 最近 10 筆訂單
- 最近編輯的商品
- 最近建立的出貨單

### Phase 22: 全域搜尋強化（優先級 P1）

#### 必須完成

**1. 權限過濾**
```php
// 在 search_products, search_orders, search_customers, search_shipments 中加入權限檢查
$current_user_id = get_current_user_id();
$seller_id = get_user_meta($current_user_id, 'managed_seller_id', true);

if ($seller_id) {
    // 小幫手：只搜尋指定賣家的資料
    $sql .= " AND seller_id = {$seller_id}";
} else {
    // 管理員或賣家：可搜尋所有資料
}
```

**2. Header 整合**
- 在所有頁面的 Header 顯示全域搜尋框
- 搜尋結果點擊後直接跳轉到對應頁面

#### 可選完成（P2）

**3. 搜尋歷史**
- 記錄最近 10 次搜尋
- 快速重新執行搜尋

**4. 熱門搜尋**
- 統計最常搜尋的關鍵字
- 提供熱門搜尋建議

**5. 進階篩選**
- 日期範圍篩選
- 狀態篩選（只搜尋特定狀態的訂單）
- 金額範圍篩選

---

## 五、與 Roadmap 的對應關係

### 假設的 Roadmap Phase 21-22

**Phase 21: Dashboard 實作**
- 建立 Dashboard 頁面
- 建立 Dashboard API
- 實作統計卡片
- 實作快速入口
- 實作待辦事項清單

**Phase 22: 全域搜尋強化**
- 權限過濾實作
- Header 整合
- 搜尋歷史
- 進階篩選

### 預估工作量

**Phase 21 (Dashboard):**
- 設計與規劃：2 小時
- Dashboard API 實作：3 小時
- Dashboard 頁面實作：4 小時
- 統計卡片實作：2 小時
- 待辦事項清單：2 小時
- 測試與調整：2 小時
- **總計：約 15 小時（2 個工作天）**

**Phase 22 (全域搜尋強化):**
- 權限過濾實作：3 小時
- Header 整合：2 小時
- 測試與調整：2 小時
- **總計：約 7 小時（1 個工作天）**

---

## 六、技術建議

### Dashboard 技術選型

**前端框架：** Vue 3（與現有頁面一致）
**圖表庫：** Chart.js（輕量、易用）
**樣式：** Design System（使用現有的 design-system/）

**參考現有頁面結構：**
```
admin/partials/dashboard.php  ← 頁面模板（定義 Vue 元件）
admin/js/components/DashboardPage.js  ← Vue 元件邏輯
admin/css/dashboard.css  ← 頁面專屬樣式
includes/api/class-dashboard-api.php  ← REST API 端點
includes/services/class-dashboard-service.php  ← 商業邏輯
```

### 全域搜尋強化技術

**權限檢查：** 使用現有的 `SettingsService::get_managed_seller_id()`
**Header 整合：** 修改 `components/shared/page-header.php`
**快取策略：** 使用 WordPress Transients API（快取搜尋結果 5 分鐘）

---

## 七、關鍵洞察

### 1. Dashboard 是「任務中心」，不只是「數據展示」

從覆盤文件可以看出，賣家的日常工作流程是：
1. 登入系統
2. 查看今天有什麼要處理的
3. 進入對應頁面處理

**因此 Dashboard 的核心價值是「告訴使用者今天要做什麼」**，而不只是「顯示統計數字」。

### 2. 全域搜尋已經很完整，只差權限控制

現有的 `class-global-search-api.php` 和 `smart-search-box.php` 已經實作了核心功能，只需要加入權限過濾，就可以滿足小幫手的需求。

### 3. 從實際工作流程反推需求

覆盤文件中沒有直接寫「我想要看到 X 統計」，但從工作流程可以推斷出實際需求：
- 訂單處理 → 需要看「待處理訂單數量」
- 商品管理 → 需要看「庫存不足的商品」
- 出貨作業 → 需要看「待出貨訂單數量」

**這比直接問「你想要什麼統計」更準確。**

---

## 八、下一步行動

### 立即行動（本週）

1. **與使用者確認 Dashboard 需求**
   - 拿這份報告給老闆確認
   - 確認統計卡片的優先順序
   - 確認待辦事項清單的內容

2. **建立 Phase 21 的 CONTEXT.md**
   - 記錄確認後的需求
   - 標記必須完成的功能（Decisions）
   - 標記 Claude 可自行決定的部分（Claude's Discretion）

3. **開始 Phase 21 研究與規劃**
   - 研究 Dashboard 的技術實作
   - 規劃 API 端點和資料結構
   - 設計 UI/UX

### 後續行動（下週）

1. **實作 Phase 21: Dashboard**
2. **實作 Phase 22: 全域搜尋強化**
3. **整合測試**

---

**報告完成日期：** 2026-01-29
**報告作者：** Claude (GSD Researcher)
**審閱者：** 待老闆確認
