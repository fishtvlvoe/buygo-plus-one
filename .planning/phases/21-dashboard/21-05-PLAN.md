---
phase: 21-dashboard
plan: 05
type: execute
wave: 3
depends_on: [21-01, 21-02, 21-03, 21-04]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Dashboard 所有功能在真實環境中正常運作"
    - "API 回應時間符合效能目標（< 500ms）"
    - "快取機制正常運作（第二次請求更快）"
    - "響應式佈局在不同裝置正常顯示"
    - "錯誤處理完整且使用者友善"
    - "無 JavaScript 錯誤或 Console 警告"
    - "所有成功標準已驗證通過"
  artifacts: []
  key_links: []
---

<objective>
Dashboard 整合測試與驗證

Purpose: 驗證 Dashboard 所有功能在真實環境中正常運作，確保達成所有成功標準
Output: 完整的測試報告和驗證結果，記錄在 SUMMARY.md
</objective>

<execution_context>
@/Users/fishtv/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fishtv/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/fishtv/Development/.planning/ROADMAP.md
@/Users/fishtv/Development/buygo-plus-one-dev/.planning/phases/21-dashboard/TECH-SOLUTION.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: API 端點功能測試</name>
  <files></files>
  <action>
測試所有 Dashboard API 端點的功能和效能：

**測試項目:**

1. **GET /dashboard/stats - 總覽統計**
   ```bash
   curl -w "\nTime: %{time_total}s\n" \
     -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/stats" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   驗證：
   - 回應時間 < 500ms
   - 回傳包含 total_revenue, total_orders, total_customers, avg_order_value
   - 每個指標包含 value, change_percent, period
   - cached_at 時間戳正確

2. **GET /dashboard/revenue - 營收趨勢**
   ```bash
   curl -w "\nTime: %{time_total}s\n" \
     -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/revenue?period=30&currency=TWD" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   驗證：
   - 回應時間 < 800ms
   - 回傳包含 labels（30 個日期）和 datasets（30 個數據點）
   - 數據格式符合 Chart.js 規格

3. **GET /dashboard/products - 商品概覽**
   ```bash
   curl -w "\nTime: %{time_total}s\n" \
     -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/products" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   驗證：
   - 回應時間 < 600ms
   - 回傳包含 total_products, published, draft

4. **GET /dashboard/activities - 最近活動**
   ```bash
   curl -w "\nTime: %{time_total}s\n" \
     -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/activities?limit=10" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   驗證：
   - 回應時間 < 400ms
   - 回傳最多 10 筆活動
   - 每筆活動包含 type, title, description, timestamp, icon, url

**記錄測試結果:**
建立 `test-results.md` 記錄每個端點的回應時間、資料格式、錯誤訊息（如有）。
  </action>
  <verify>
所有 API 端點回應正常，效能符合目標
  </verify>
  <done>
API 功能測試完成，所有端點正常運作
  </done>
</task>

<task type="auto">
  <name>Task 2: 快取機制驗證</name>
  <files></files>
  <action>
驗證 API 快取機制正常運作：

**測試步驟:**

1. **首次請求（無快取）:**
   ```bash
   time curl -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/stats" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   記錄回應時間（例如 450ms）

2. **第二次請求（有快取）:**
   ```bash
   time curl -X GET "https://test.buygo.me/wp-json/buygo-plus-one/v1/dashboard/stats" \
     -H "X-WP-Nonce: $(wp eval 'echo wp_create_nonce("wp_rest");')"
   ```
   記錄回應時間（應 < 50ms）

3. **檢查快取資料:**
   ```bash
   wp transient get buygo_dashboard_stats
   wp transient get buygo_dashboard_stats_time
   ```
   驗證快取資料存在且格式正確

4. **清除快取後重新測試:**
   ```bash
   wp transient delete buygo_dashboard_stats
   wp transient delete buygo_dashboard_stats_time
   ```
   再次請求，確認重新計算（回應時間變慢）

**驗證標準:**
- 首次請求執行完整查詢（較慢）
- 快取命中時回應時間 < 50ms
- 快取過期後自動重新計算
- cached_at 時間戳正確更新

**記錄測試結果:**
記錄快取命中率、回應時間對比、快取過期行為。
  </action>
  <verify>
快取機制正常運作，效能提升明顯
  </verify>
  <done>
快取驗證完成，快取機制正常運作
  </done>
</task>

<task type="auto">
  <name>Task 3: 前端功能測試</name>
  <files></files>
  <action>
在瀏覽器中測試 Dashboard 前端功能：

**測試項目:**

1. **頁面載入:**
   - 訪問 https://test.buygo.me/buygo-portal/dashboard/
   - 檢查頁面正常載入（無白屏或錯誤）
   - 檢查 Console 無錯誤或警告

2. **統計卡片:**
   - 檢查 4 個統計卡片正確顯示
   - 檢查數字格式正確（金額有千分位、貨幣符號）
   - 檢查變化百分比顏色正確（正數綠色、負數紅色）
   - 檢查 hover 效果正常（陰影出現）

3. **營收趨勢圖:**
   - 檢查 Chart.js 圖表正確渲染
   - 檢查圖表顯示 30 天數據
   - 檢查 hover tooltip 顯示正確金額
   - 檢查 Y 軸金額格式正確

4. **商品概覽:**
   - 檢查顯示 3 個統計數字（總數、已上架、待上架）
   - 檢查數字與實際資料一致

5. **最近活動:**
   - 檢查顯示最多 10 筆活動
   - 檢查活動類型圖示正確（訂單/客戶）
   - 檢查時間顯示為相對時間（「5 分鐘前」）

6. **載入狀態:**
   - 暫時延遲 API 回應（在 DevTools 中設定網路節流）
   - 檢查骨架屏正常顯示
   - 檢查載入完成後骨架屏消失

7. **錯誤處理:**
   - 暫時讓 API 返回錯誤（修改 API 程式碼或使用 DevTools 攔截請求）
   - 檢查錯誤訊息正確顯示
   - 檢查「重新載入」按鈕可用

**記錄測試結果:**
截圖記錄每個功能的測試結果。
  </action>
  <verify>
所有前端功能正常，使用者體驗良好
  </verify>
  <done>
前端功能測試完成，所有功能正常運作
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Dashboard 完整功能（API + 前端 + 樣式）已自動實作並測試
  </what-built>
  <how-to-verify>
請在瀏覽器中測試 Dashboard 功能：

**測試步驟:**

1. **訪問 Dashboard 頁面**
   - URL: https://test.buygo.me/buygo-portal/dashboard/
   - 登入賣家帳號（如需要）

2. **桌面版測試（視窗寬度 > 768px）**
   - [ ] 統計卡片 4 欄排列
   - [ ] 本月總營收、訂單數、客戶數、平均訂單金額正確顯示
   - [ ] 變化百分比顏色正確（正數綠色 ↑、負數紅色 ↓）
   - [ ] 營收趨勢圖顯示折線圖（30 天資料）
   - [ ] Hover 圖表顯示詳細金額
   - [ ] 商品概覽顯示總數/已上架/待上架（橫向排列）
   - [ ] 最近活動顯示 10 筆事件（訂單藍色、客戶綠色）

3. **手機版測試（視窗寬度 < 768px）**
   - [ ] 統計卡片 1 欄排列（垂直）
   - [ ] 圖表正常顯示（高度較低但仍可讀）
   - [ ] 商品概覽垂直排列（列表樣式）
   - [ ] 活動列表垂直排列

4. **功能測試**
   - [ ] 重新整理頁面，資料正確載入
   - [ ] 檢查 Console 無錯誤（F12 開發者工具）
   - [ ] 統計數字與實際資料一致（可與訂單/商品頁面比對）

**預期結果:**
- 所有統計數據正確顯示
- 圖表正常渲染且互動流暢
- 響應式佈局在不同裝置正常
- 無視覺錯誤或功能異常

**如有問題:**
請描述具體問題（截圖更佳）：
- 哪個區塊有問題？
- 預期行為是什麼？
- 實際行為是什麼？
  </how-to-verify>
  <resume-signal>
輸入「通過」或「approved」繼續，或描述發現的問題
  </resume-signal>
</task>

<task type="auto">
  <name>Task 5: 效能優化檢查</name>
  <files></files>
  <action>
檢查 Dashboard 效能並優化（如需要）：

**效能檢查項目:**

1. **資料庫查詢效能:**
   ```bash
   # 啟用 WordPress 查詢監控
   wp eval '
   global $wpdb;
   $wpdb->show_errors();
   define("SAVEQUERIES", true);
   '

   # 訪問 Dashboard，檢查查詢數量和執行時間
   wp eval '
   global $wpdb;
   echo "Total queries: " . count($wpdb->queries) . "\n";
   foreach ($wpdb->queries as $q) {
       if ($q[1] > 0.1) {
           echo "Slow query (" . $q[1] . "s): " . substr($q[0], 0, 100) . "...\n";
       }
   }
   '
   ```

2. **前端載入效能:**
   - 開啟 DevTools > Network
   - 檢查 CSS/JS 檔案載入時間
   - 檢查 API 請求數量和回應時間
   - 記錄 DOMContentLoaded 和 Load 時間

3. **記憶體使用:**
   - 開啟 DevTools > Performance
   - 錄製頁面載入過程
   - 檢查記憶體使用量（應 < 50MB）
   - 檢查無記憶體洩漏

**優化建議（如需要）:**
- 慢查詢加入索引
- 合併多次 API 請求
- 調整快取時間
- 壓縮 CSS/JS 檔案

**記錄效能指標:**
記錄頁面載入時間、API 回應時間、資料庫查詢數量。
  </action>
  <verify>
效能符合目標，使用者體驗流暢
  </verify>
  <done>
效能檢查完成，Dashboard 效能符合目標
  </done>
</task>

<task type="auto">
  <name>Task 6: 建立測試報告和文件</name>
  <files></files>
  <action>
建立完整的測試報告和使用者文件：

**1. 測試報告（21-05-TEST-REPORT.md）**

記錄所有測試結果：
```markdown
# Dashboard 測試報告

## API 測試結果

### /dashboard/stats
- 首次回應時間: 420ms
- 快取回應時間: 35ms
- 資料格式: ✅ 正確
- 錯誤處理: ✅ 正常

### /dashboard/revenue
- 首次回應時間: 680ms
- 快取回應時間: 42ms
- 資料格式: ✅ 正確
- Chart.js 相容: ✅ 正常

... (其他端點)

## 前端測試結果

### 桌面版（1920x1080）
- 統計卡片: ✅ 4 欄排列正確
- 圖表渲染: ✅ 正常
- 響應式: ✅ 正確

### 手機版（375x667）
- 統計卡片: ✅ 1 欄排列正確
- 圖表渲染: ✅ 正常
- 響應式: ✅ 正確

## 效能指標

- 頁面載入時間: 1.2s
- API 平均回應: 450ms
- 資料庫查詢數: 8
- 記憶體使用: 32MB

## 成功標準驗證

✅ 所有成功標準已通過
```

**2. 使用者文件（21-05-USER-GUIDE.md）**

簡單的使用說明：
```markdown
# Dashboard 使用指南

## 存取方式

訪問 https://test.buygo.me/buygo-portal/dashboard/

## 功能說明

### 統計卡片
顯示本月營運概況，包含：
- 總營收: 本月已付款訂單總金額
- 訂單數: 本月訂單總數
- 客戶數: 本月下單客戶數
- 平均訂單: 平均每筆訂單金額

變化百分比顯示與上月比較結果。

### 營收趨勢圖
折線圖顯示過去 30 天的每日營收變化。

### 商品概覽
顯示商品總數、已上架、待上架數量。

### 最近活動
顯示最近 10 筆訂單和客戶註冊事件。
```

儲存文件到 `.planning/phases/21-dashboard/` 目錄。
  </action>
  <verify>
測試報告和使用者文件完整且清晰
  </verify>
  <done>
測試報告和文件建立完成
  </done>
</task>

</tasks>

<verification>
**最終驗證檢查清單:**

**功能驗證:**
- [ ] 所有 API 端點正常運作
- [ ] 快取機制正常運作
- [ ] 前端所有功能正常
- [ ] 響應式佈局正確
- [ ] 錯誤處理完整

**效能驗證:**
- [ ] API 回應時間 < 500ms（首次）
- [ ] API 回應時間 < 50ms（快取）
- [ ] 頁面載入時間 < 2s
- [ ] 無慢查詢（> 0.5s）

**使用者體驗:**
- [ ] 視覺效果符合設計系統
- [ ] 無視覺錯誤或排版問題
- [ ] 載入狀態友善
- [ ] 錯誤提示清晰

**文件完整性:**
- [ ] 測試報告記錄完整
- [ ] 使用者指南清晰
- [ ] SUMMARY.md 記錄執行過程

**成功標準（來自 Roadmap）:**
- [ ] 賣家可存取 /buygo-portal/dashboard/ 看到營運概覽
- [ ] Dashboard 顯示訂單統計（今日/本週/本月訂單數和金額）
- [ ] Dashboard 顯示營收趨勢圖表（最近 7 天或 30 天）
- [ ] Dashboard 顯示商品概覽（總商品數、已上架、待上架）
- [ ] Dashboard 顯示最近活動時間軸（最新 10 筆系統事件）
- [ ] Header 通知圖示顯示未讀通知數量（註：此項為 Phase 22 範圍，本階段不實作）
- [ ] Dashboard 在桌面版和手機版都正常顯示
</verification>

<success_criteria>
- [ ] 所有自動測試通過
- [ ] 真人驗證通過
- [ ] 效能符合目標
- [ ] 文件完整
- [ ] 無已知 Bug
- [ ] 成功標準達成（除 Header 通知圖示外）
</success_criteria>

<output>
完成後建立 `.planning/phases/21-dashboard/21-05-SUMMARY.md` 記錄完整執行結果、測試報告和發現的問題（如有）
</output>
