# Dashboard 使用指南

**版本:** 1.0
**更新日期:** 2026-01-29
**適用外掛:** BuyGo Plus One v0.0.3+

---

## 快速開始

### 存取 Dashboard

1. 登入 WordPress 後台
2. 在左側選單點擊「BuyGo+1」
3. 點擊「儀表板」或直接訪問 http://buygo.me/buygo-portal/dashboard/

### 首次使用設定

**如果 Dashboard 頁面無法載入（404 或 500 錯誤）:**

1. **Flush Rewrite Rules（一次性操作）**
   - 前往「設定 → 永久連結」
   - 不需修改任何設定，直接點擊「儲存變更」
   - 重新訪問 Dashboard 頁面

2. **清除快取（如適用）**
   - 如果使用快取外掛（如 WP Super Cache、W3 Total Cache），清除所有快取
   - 如果使用 CDN（如 Cloudflare），清除 CDN 快取

---

## 功能說明

### 1. 統計卡片區（頁面頂部）

Dashboard 頂部顯示 4 個重要營運指標：

#### 📊 本月總營收

**顯示內容:**
- 本月已付款訂單的總金額
- 與上月相比的變化百分比

**說明:**
- 只計算 `payment_status = 'paid'` 的訂單
- 只計算 `mode = 'live'` 的訂單（排除測試訂單）
- 金額以「元」為單位顯示（資料庫儲存為「分」）

**範例:**
```
本月總營收
NT$ 158,000
↑ 12.5% 與上月相比
```

**變化百分比顏色:**
- 🟢 綠色 + ↑ 箭頭：營收成長
- 🔴 紅色 + ↓ 箭頭：營收下降

---

#### 📦 本月訂單數

**顯示內容:**
- 本月訂單總數
- 與上月相比的變化百分比

**說明:**
- 只計算已付款訂單
- 包含所有訂單類型（一般訂單、父訂單、子訂單）

**範例:**
```
本月訂單數
234 筆
↑ 8.3% 與上月相比
```

---

#### 👥 本月客戶數

**顯示內容:**
- 本月下單的不重複客戶數量
- 與上月相比的變化百分比

**說明:**
- 使用 `COUNT(DISTINCT customer_id)` 避免重複計算
- 同一客戶下多筆訂單只計算一次

**範例:**
```
本月客戶數
156 人
↑ 5.1% 與上月相比
```

---

#### 💰 平均訂單金額

**顯示內容:**
- 本月平均每筆訂單的金額
- 與上月相比的變化百分比

**計算公式:**
```
平均訂單金額 = 本月總營收 ÷ 本月訂單數
```

**範例:**
```
平均訂單金額
NT$ 675
↑ 3.2% 與上月相比
```

---

### 2. 營收趨勢圖（中段左側）

**顯示內容:**
- 過去 30 天的每日營收折線圖
- 互動式圖表（hover 顯示詳細金額）

**功能:**

1. **查看每日營收**
   - X 軸：日期（mm/dd 格式）
   - Y 軸：營收金額（NT$ 格式，千分位逗號）

2. **Hover 互動**
   - 將滑鼠移到圖表上任一點
   - 顯示該日期的詳細營收金額

3. **幣別切換**
   - 點擊右上角幣別按鈕（💱 圖示）
   - 支援 TWD（新台幣）、USD（美元）、CNY（人民幣）
   - 切換後圖表自動更新

**資料說明:**
- 只計算已付款訂單（`payment_status = 'paid'`）
- 沒有訂單的日期顯示為 0
- 資料自動快取 15 分鐘

---

### 3. 商品概覽（中段右側）

**顯示內容:**
- 總商品數
- 已上架商品數
- 待上架商品數

**範例:**
```
商品概覽
─────────────────
總商品數         123
已上架           98
待上架（草稿）    25
```

**狀態說明:**
- **已上架:** `post_status = 'publish'`（客戶可見）
- **待上架:** `post_status = 'draft'`（僅管理員可見）

---

### 4. 最近活動（底部）

**顯示內容:**
- 最近 10 筆訂單活動
- 包含訂單編號、客戶名稱、金額、時間

**範例:**
```
最近活動
──────────────────────────────
🛒 新訂單 #12345
   張三 下單 NT$ 1,580
   5 分鐘前

🛒 新訂單 #12344
   李四 下單 NT$ 890
   12 分鐘前

🛒 新訂單 #12343
   王五 下單 NT$ 2,340
   25 分鐘前
```

**功能:**

1. **查看訂單詳情**
   - 點擊任一活動項目
   - 跳轉到該訂單的詳情頁面

2. **時間顯示**
   - 自動轉換為相對時間（更易讀）
   - 5 分鐘內：「X 分鐘前」
   - 1 小時內：「X 分鐘前」
   - 1 天內：「X 小時前」
   - 超過 1 天：「X 天前」

**資料說明:**
- 只顯示最近 7 天的活動
- 資料快取 1 分鐘（更即時）
- 按時間降序排列（最新的在最上方）

---

## 響應式設計

Dashboard 支援桌面版、平板、手機三種螢幕尺寸。

### 桌面版（寬度 > 768px）

**佈局:**
```
┌───────────────────────────────────────┐
│ 統計卡片（4 欄水平排列）                │
├───────────────────────────────────────┤
│ 營收趨勢圖（全寬）                      │
├──────────────────┬────────────────────┤
│ 商品概覽（1/3）  │ 最近活動（2/3）    │
└──────────────────┴────────────────────┘
```

### 手機版（寬度 < 768px）

**佈局:**
```
┌─────────────┐
│ 統計卡片 1  │
├─────────────┤
│ 統計卡片 2  │
├─────────────┤
│ 統計卡片 3  │
├─────────────┤
│ 統計卡片 4  │
├─────────────┤
│ 營收趨勢圖  │
├─────────────┤
│ 商品概覽    │
├─────────────┤
│ 最近活動    │
└─────────────┘
```

**適應特性:**
- 統計卡片：4 欄 → 2 欄 → 1 欄（自動調整）
- 圖表高度：桌面 300px、手機 250px
- 底部區域：水平排列 → 垂直堆疊

---

## 資料更新頻率

Dashboard 使用快取機制提升效能,不同資料有不同的更新頻率:

| 資料類型 | 快取時間 | 說明 |
|---------|---------|------|
| **統計卡片** | 5 分鐘 | 本月總營收、訂單數、客戶數、平均金額 |
| **營收趨勢** | 15 分鐘 | 過去 30 天的每日營收圖表 |
| **商品概覽** | 15 分鐘 | 商品總數、已上架、待上架 |
| **最近活動** | 1 分鐘 | 最近 10 筆訂單（需要即時性） |

**手動刷新資料:**
- 重新整理頁面（F5 或 Ctrl+R）
- 如果資料沒有更新,可能快取尚未過期（等待快取過期時間）

---

## 常見問題

### Q1: Dashboard 頁面顯示 404 錯誤

**原因:** WordPress rewrite rules 未更新

**解決方案:**
1. 前往「設定 → 永久連結」
2. 點擊「儲存變更」（不需修改任何設定）
3. 重新訪問 Dashboard 頁面

---

### Q2: Dashboard 頁面顯示 500 錯誤

**可能原因:**
1. 外掛未正確載入
2. PHP 記憶體不足
3. 資料庫連線問題

**解決方案:**
1. 停用並重新啟用 `buygo-plus-one-dev` 外掛
2. 檢查 PHP 錯誤日誌（`wp-content/debug.log`）
3. 增加 PHP 記憶體限制（在 `wp-config.php` 加入 `define('WP_MEMORY_LIMIT', '256M');`）

---

### Q3: 統計數字顯示為 0

**可能原因:**
1. 本月確實沒有訂單
2. 訂單狀態不是 `paid`
3. 訂單模式是 `test`（測試訂單）

**檢查方法:**
1. 前往「訂單」頁面確認是否有訂單
2. 檢查訂單的付款狀態（應為「已付款」）
3. 檢查訂單模式（應為 `live`，非 `test`）

---

### Q4: 營收趨勢圖沒有顯示

**可能原因:**
1. Chart.js CDN 載入失敗
2. JavaScript 錯誤
3. 資料格式錯誤

**檢查方法:**
1. 開啟瀏覽器 DevTools（F12）
2. 檢查「Console」標籤是否有錯誤訊息
3. 檢查「Network」標籤,確認 Chart.js CDN 成功載入（狀態 200）

---

### Q5: 變化百分比計算方式

**計算公式:**
```
變化百分比 = ((本月數值 - 上月數值) / 上月數值) * 100
```

**特殊情況:**
- 上月數值為 0，本月有數值：顯示 +100%
- 上月數值為 0，本月也為 0：顯示 0%
- 本月數值大於上月：顯示正數（綠色 ↑）
- 本月數值小於上月：顯示負數（紅色 ↓）

---

### Q6: 幣別轉換如何運作

**支援幣別:**
- TWD（新台幣）- 預設
- USD（美元）
- CNY（人民幣）

**轉換方式:**
- 點擊右上角幣別按鈕（💱 圖示）
- 循環切換：TWD → USD → CNY → TWD
- 只影響營收趨勢圖的顯示
- 統計卡片仍以 TWD 顯示（因為訂單本身以 TWD 計價）

**注意事項:**
- 如果資料庫中沒有該幣別的訂單,圖表會顯示為空
- 幣別切換後會重新調用 API（可能需要幾秒鐘）

---

### Q7: 為什麼最近活動只顯示訂單,沒有客戶註冊?

**當前版本限制:**
- 最近活動目前只顯示訂單活動
- 未來版本會加入客戶註冊、商品上架等其他活動類型

**時間軸:**
- 已在技術債中記錄
- 預計在 Phase 22 或 23 實作

---

### Q8: 如何清除 Dashboard 快取

**方法 1: 等待自動過期**
- 統計卡片：5 分鐘後自動更新
- 營收趨勢/商品概覽：15 分鐘後自動更新
- 最近活動：1 分鐘後自動更新

**方法 2: 手動清除（需要 WP-CLI 或程式碼）**

使用 WP-CLI:
```bash
wp transient delete buygo_dashboard_stats
wp transient delete buygo_dashboard_revenue_30_TWD
wp transient delete buygo_dashboard_products
wp transient delete buygo_dashboard_activities_10
```

使用 PHP 程式碼（在 WordPress 後台「工具 → 網站健康 → 資訊 → 除錯」執行）:
```php
delete_transient('buygo_dashboard_stats');
delete_transient('buygo_dashboard_revenue_30_TWD');
delete_transient('buygo_dashboard_products');
delete_transient('buygo_dashboard_activities_10');
```

---

## 效能優化建議

### 如果 Dashboard 載入速度慢

1. **檢查資料庫效能**
   - 確認 `wp_fct_orders` 表有索引（`created_at`, `payment_status`, `customer_id`）
   - 如果訂單量很大（> 10,000 筆），考慮增加快取時間

2. **檢查伺服器資源**
   - 確認 PHP 記憶體足夠（建議 256MB+）
   - 確認 MySQL 查詢快取已啟用

3. **使用 CDN**
   - Chart.js 已使用 CDN（jsDelivr）
   - 確認 CDN 未被防火牆阻擋

---

## 技術規格

### API 端點

| 端點 | 用途 | 快取時間 |
|------|------|---------|
| `GET /wp-json/buygo-plus-one/v1/dashboard/stats` | 總覽統計 | 5 分鐘 |
| `GET /wp-json/buygo-plus-one/v1/dashboard/revenue` | 營收趨勢 | 15 分鐘 |
| `GET /wp-json/buygo-plus-one/v1/dashboard/products` | 商品概覽 | 15 分鐘 |
| `GET /wp-json/buygo-plus-one/v1/dashboard/activities` | 最近活動 | 1 分鐘 |

### 資料來源

| 資料類型 | 資料表 |
|---------|--------|
| 訂單統計 | `wp_fct_orders` |
| 客戶統計 | `wp_fct_customers` |
| 商品統計 | `wp_posts` (post_type = 'fluent-products') |

### 前端技術

- **框架:** Vue 3 (Composition API)
- **圖表庫:** Chart.js 4.x
- **樣式:** Tailwind CSS + 自訂 CSS
- **響應式:** 斷點 768px (桌面/手機)

---

## 更新日誌

### v1.0 (2026-01-29)

**新功能:**
- ✨ 統計卡片顯示本月營運指標
- ✨ 營收趨勢折線圖（30 天）
- ✨ 商品概覽統計
- ✨ 最近活動時間軸
- ✨ 響應式佈局支援桌面/手機
- ✨ 幣別切換功能（TWD/USD/CNY）
- ✨ 快取機制提升效能

**已知限制:**
- 最近活動只顯示訂單（未來會加入其他活動類型）
- 營收趨勢固定顯示 30 天（未來會支援自訂日期範圍）
- 幣別切換只影響圖表（統計卡片固定顯示 TWD）

---

## 支援

如有問題或建議,請聯繫:
- **技術支援:** 透過 WordPress 後台「BuyGo+1 → 設定 → 除錯工具」
- **文件:** 查看 `.planning/phases/21-dashboard/` 目錄下的技術文件

---

**使用指南版本:** 1.0
**最後更新:** 2026-01-29
**下次更新:** 功能更新後
