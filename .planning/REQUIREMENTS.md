# Requirements: BuyGo+1

**Core Value:** è®“ LINE ç¤¾ç¾¤è³£å®¶èƒ½å¤ åœ¨ä¸€å€‹çµ±ä¸€çš„å¾Œå°ç®¡ç†æ‰€æœ‰éŠ·å”®æ´»å‹•ï¼Œæ¯å€‹è³£å®¶åªèƒ½çœ‹åˆ°è‡ªå·±çš„å•†å“å’Œè¨‚å–®

---

## v1.3 Requirements (Active)

**Milestone:** v1.3 - å‡ºè²¨é€šçŸ¥èˆ‡ FluentCart åŒæ­¥ç³»çµ±
**Defined:** 2026-02-02

### è³‡æ–™æ¨¡å‹æ“´å…… (DATA)

- [ ] **DATA-01**: æ–°å¢ estimated_delivery_at æ¬„ä½åˆ° buygo_shipments è¡¨
  - **èªªæ˜**: åœ¨ buygo_shipments è³‡æ–™è¡¨æ–°å¢ DATETIME é¡å‹çš„ estimated_delivery_at æ¬„ä½,ç”¨æ–¼å„²å­˜è³£å®¶è¨­å®šçš„é è¨ˆé€é”æ™‚é–“
  - **é©—æ”¶æ¨™æº–**:
    - æ¬„ä½é¡å‹ç‚º DATETIME (NULL allowed)
    - ä½¿ç”¨ dbDelta å‡ç´šæ©Ÿåˆ¶,ç¢ºä¿å‘å¾Œç›¸å®¹
    - ç¾æœ‰å‡ºè²¨å–®è³‡æ–™ä¸å—å½±éŸ¿
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **DATA-02**: è³‡æ–™åº«å‡ç´šè…³æœ¬
  - **èªªæ˜**: åœ¨ Database::upgrade_tables() ä¸­å¯¦ä½œ estimated_delivery_at æ¬„ä½å‡ç´šé‚è¼¯
  - **é©—æ”¶æ¨™æº–**:
    - ä½¿ç”¨ idempotent æª¢æŸ¥,é¿å…é‡è¤‡åŸ·è¡Œ
    - æ›´æ–° DB_VERSION ç‰ˆæœ¬è™Ÿ
    - å‡ç´šéç¨‹ä¸é–è¡¨,ä¸å½±éŸ¿ç¾æœ‰åŠŸèƒ½
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **DATA-03**: å¾Œå°å‡ºè²¨å–®å»ºç«‹/ç·¨è¼¯è¡¨å–®æ–°å¢ã€Œé è¨ˆé€é”æ™‚é–“ã€è¼¸å…¥æ¬„ä½
  - **èªªæ˜**: åœ¨å‡ºè²¨å–®å»ºç«‹/ç·¨è¼¯é é¢æ–°å¢æ—¥æœŸé¸æ“‡å™¨,è®“è³£å®¶è¼¸å…¥é è¨ˆé€é”æ™‚é–“
  - **é©—æ”¶æ¨™æº–**:
    - ä½¿ç”¨ HTML5 datetime-local æˆ– Vue æ—¥æœŸé¸æ“‡å™¨å…ƒä»¶
    - æ¬„ä½ç‚ºé¸å¡« (optional)
    - å„²å­˜æ™‚æ ¼å¼åŒ–ç‚º MySQL DATETIME æ ¼å¼
  - **å„ªå…ˆç´š**: P1 (é‡è¦)

### LINE å‡ºè²¨é€šçŸ¥ (NOTIF)

- [ ] **NOTIF-01**: NotificationHandler ç›£è½å‡ºè²¨å–®æ¨™è¨˜ç‚ºã€Œå·²å‡ºè²¨ã€äº‹ä»¶
  - **èªªæ˜**: å»ºç«‹ NotificationHandler é¡åˆ¥,ç›£è½ `buygo/shipment/marked_as_shipped` WordPress Action Hook
  - **é©—æ”¶æ¨™æº–**:
    - åœ¨ ShipmentService::markAsShipped() ä¸­è§¸ç™¼ `do_action('buygo/shipment/marked_as_shipped', $shipment_id)`
    - NotificationHandler æ­£ç¢ºè¨»å†Šåˆ° Plugin::register_hooks()
    - ä½¿ç”¨ try-catch ç¢ºä¿é€šçŸ¥å¤±æ•—ä¸å½±éŸ¿å‡ºè²¨æµç¨‹
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **NOTIF-02**: æ”¶é›†å‡ºè²¨å–®è³‡è¨Š
  - **èªªæ˜**: å¾è³‡æ–™åº«æŸ¥è©¢å‡ºè²¨å–®ç›¸é—œè³‡è¨Š,åŒ…å«å•†å“æ¸…å–®ã€æ•¸é‡ã€ç‰©æµæ–¹å¼ã€é è¨ˆé€é”æ™‚é–“
  - **é©—æ”¶æ¨™æº–**:
    - æŸ¥è©¢ buygo_shipments å’Œ buygo_shipment_items
    - æ•´ç†æˆé€šçŸ¥æ¨¡æ¿æ‰€éœ€çš„è³‡æ–™çµæ§‹
    - è™•ç† estimated_delivery_at ç‚º NULL çš„æƒ…æ³
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **NOTIF-03**: å¥—ç”¨å‡ºè²¨é€šçŸ¥æ¨¡æ¿
  - **èªªæ˜**: åœ¨ NotificationTemplates::definitions() æ–°å¢ shipment_shipped æ¨¡æ¿å®šç¾©
  - **é©—æ”¶æ¨™æº–**:
    - é è¨­æ¨¡æ¿åŒ…å«è®Šæ•¸: {product_list}, {shipping_method}, {estimated_delivery}
    - è®Šæ•¸æ›¿æ›é‚è¼¯æ­£ç¢ºè™•ç†å¤šå•†å“æƒ…æ³
    - æ”¯æ´è‡ªè¨‚æ¨¡æ¿ (å¾ wp_options è®€å–)
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **NOTIF-04**: é€é NotificationService ç™¼é€ LINE é€šçŸ¥çµ¦è²·å®¶
  - **èªªæ˜**: æŸ¥è©¢è²·å®¶çš„ LINE User ID,é€é NotificationService ç™¼é€é€šçŸ¥
  - **é©—æ”¶æ¨™æº–**:
    - æ­£ç¢ºè­˜åˆ¥è²·å®¶èº«ä»½ (customer_id â†’ WordPress user_id â†’ LINE User ID)
    - åƒ…é€šçŸ¥è²·å®¶,ä¸é€šçŸ¥è³£å®¶å’Œå°å¹«æ‰‹
    - æ•´åˆ buygo-line-notify å¤–æ› (ä½¿ç”¨ Soft Dependency æ¨¡å¼)
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **NOTIF-05**: ç¢ºä¿ä¸€å¼µå‡ºè²¨å–®åªç™¼é€ä¸€æ¬¡é€šçŸ¥
  - **èªªæ˜**: å¯¦ä½œ idempotency æ©Ÿåˆ¶,é˜²æ­¢é‡è¤‡ç™¼é€é€šçŸ¥
  - **é©—æ”¶æ¨™æº–**:
    - æ–°å¢ notification_sent_at æ¬„ä½åˆ° buygo_shipments è¡¨ (æˆ–ä½¿ç”¨ç¾æœ‰ shipped_at)
    - æª¢æŸ¥ notification_sent_at æ˜¯å¦ç‚º NULL,å·²ç™¼é€å‰‡è·³é
    - ç™¼é€æˆåŠŸå¾Œæ›´æ–° notification_sent_at ç‚ºç•¶å‰æ™‚é–“
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

### é€šçŸ¥æ¨¡æ¿ç®¡ç† (TMPL)

- [ ] **TMPL-01**: Settings é é¢æ–°å¢ã€Œé€šçŸ¥æ¨¡æ¿ã€è¨­å®šå€å¡Š
  - **èªªæ˜**: åœ¨ Settings é é¢ (Vue 3 å…ƒä»¶) æ–°å¢ã€Œé€šçŸ¥æ¨¡æ¿ç®¡ç†ã€å€å¡Š
  - **é©—æ”¶æ¨™æº–**:
    - é¡¯ç¤ºæ‰€æœ‰å¯ç”¨é€šçŸ¥é¡å‹ (å•†å“ä¸Šæ¶ã€æ–°è¨‚å–®ã€è¨‚å–®ç‹€æ…‹è®Šæ›´ã€å‡ºè²¨é€šçŸ¥)
    - é»æ“Šã€Œç·¨è¼¯ã€æŒ‰éˆ•é€²å…¥æ¨¡æ¿ç·¨è¼¯å™¨
    - ä½¿ç”¨ç¾æœ‰ Settings é é¢çš„è¨­è¨ˆç³»çµ±æ¨£å¼
  - **å„ªå…ˆç´š**: P1 (é‡è¦)

- [ ] **TMPL-02**: å‡ºè²¨é€šçŸ¥æ¨¡æ¿ç·¨è¼¯å™¨
  - **èªªæ˜**: æä¾›æ–‡å­—ç·¨è¼¯å™¨è®“å®¢æˆ¶è‡ªè¨‚å‡ºè²¨é€šçŸ¥æ¨¡æ¿å…§å®¹
  - **é©—æ”¶æ¨™æº–**:
    - é¡¯ç¤ºå¯ç”¨è®Šæ•¸åˆ—è¡¨: {product_list}, {shipping_method}, {estimated_delivery}
    - å³æ™‚é è¦½åŠŸèƒ½ (optional,å¯å»¶å¾Œå¯¦ä½œ)
    - æä¾›ã€Œé‡è¨­ç‚ºé è¨­å€¼ã€æŒ‰éˆ•
  - **å„ªå…ˆç´š**: P1 (é‡è¦)

- [ ] **TMPL-03**: é è¨­å‡ºè²¨é€šçŸ¥æ¨¡æ¿
  - **èªªæ˜**: å®šç¾©é è¨­çš„å‡ºè²¨é€šçŸ¥æ¨¡æ¿å…§å®¹
  - **é©—æ”¶æ¨™æº–**:
    - æ¨¡æ¿å…§å®¹æ¸…æ™°æ˜“æ‡‚,ç¬¦åˆå°ç£ç”¨æˆ¶ç¿’æ…£
    - åŒ…å«æ‰€æœ‰å¿…è¦è³‡è¨Š (å•†å“ã€ç‰©æµã€é è¨ˆé€é”)
    - é è¨­æ¨¡æ¿ç¯„ä¾‹:
      ```
      æ‚¨çš„è¨‚å–®å·²å‡ºè²¨å›‰! ğŸ“¦

      å•†å“æ¸…å–®:
      {product_list}

      ç‰©æµæ–¹å¼: {shipping_method}
      é è¨ˆé€é”: {estimated_delivery}

      æ„Ÿè¬æ‚¨çš„è³¼è²·!
      ```
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

- [ ] **TMPL-04**: æ¨¡æ¿å„²å­˜åˆ° wp_options
  - **èªªæ˜**: å¯¦ä½œæ¨¡æ¿ CRUD REST API,å„²å­˜å®¢æˆ¶è‡ªè¨‚æ¨¡æ¿åˆ° wp_options
  - **é©—æ”¶æ¨™æº–**:
    - wp_options key: `buygo_notification_template_shipment_shipped`
    - ä½¿ç”¨ update_option() å’Œ get_option()
    - æ•´åˆå¤šå±¤å¿«å– (static cache + wp_cache)
  - **å„ªå…ˆç´š**: P1 (é‡è¦)

- [ ] **TMPL-05**: æ¨¡æ¿è®Šæ•¸æ›¿æ›é‚è¼¯
  - **èªªæ˜**: å¯¦ä½œè®Šæ•¸æ›¿æ›é‚è¼¯,å°‡ {product_list} ç­‰è®Šæ•¸æ›¿æ›ç‚ºå¯¦éš›è³‡æ–™
  - **é©—æ”¶æ¨™æº–**:
    - ä½¿ç”¨ esc_html() é˜²æ­¢ XSS æ¼æ´
    - æ­£ç¢ºè™•ç†å¤šå•†å“æƒ…æ³ (å•†å“æ¸…å–®æ ¼å¼åŒ–)
    - è™•ç† estimated_delivery ç‚ºç©ºçš„æƒ…æ³ (é¡¯ç¤ºã€Œæœªè¨­å®šã€æˆ–é¡ä¼¼è¨Šæ¯)
  - **å„ªå…ˆç´š**: P0 (å¿…é ˆ)

### Out of Scope (v1.3)

- **è¿½è¹¤ç·¨è™Ÿé¡¯ç¤º** â€” å°ç£ç‰©æµå•†è¿½è¹¤ç³»çµ±æ”¯æ´åº¦ä½,æ¨¡æ¿ä¸­æš«ä¸é¡¯ç¤ºè¿½è¹¤ç·¨è™Ÿ
- **å‡ºè²¨å–®ç·¨è™Ÿé¡¯ç¤º** â€” è²·å®¶ä¸é—œå¿ƒå…§éƒ¨å‡ºè²¨å–®ç·¨è™Ÿ,æ¨¡æ¿ä¸­æš«ä¸é¡¯ç¤º
- **è³£å®¶/å°å¹«æ‰‹å‡ºè²¨é€šçŸ¥** â€” è³£å®¶è‡ªå·±æ¨™è¨˜å‡ºè²¨ä¸éœ€é€šçŸ¥è‡ªå·±,å°å¹«æ‰‹ä¹Ÿä¸éœ€æ”¶åˆ°å‡ºè²¨ç¢ºèªé€šçŸ¥
- **å¤šèªç³»æ”¯æ´** â€” åƒ…æ”¯æ´ç¹é«”ä¸­æ–‡,æœªä¾†å¯æ“´å……è‹±æ–‡/ç°¡é«”ä¸­æ–‡
- **é€²éšæ¨¡æ¿ç·¨è¼¯å™¨** â€” åŸºç¤æ–‡å­—ç·¨è¼¯å³å¯,ä¸éœ€è¦ WYSIWYG æˆ–æ‹–æ‹‰å¼ç·¨è¼¯å™¨
- **æ™ºèƒ½é æ¸¬é€é”æ™‚é–“** â€” v1.3 ä½¿ç”¨æ‰‹å‹•è¼¸å…¥,v1.4+ å¯åŸºæ–¼æ­·å²è³‡æ–™å¯¦ä½œæ™ºèƒ½é æ¸¬
- **å¤šç­†å‡ºè²¨åˆä½µé€šçŸ¥** â€” v1.3 æ¯å¼µå‡ºè²¨å–®ç¨ç«‹é€šçŸ¥,æœªä¾†å¯æ”¯æ´ã€ŒåŒä¸€è²·å®¶å¤šå¼µå‡ºè²¨å–®åˆä½µç‚ºä¸€æ¬¡é€šçŸ¥ã€
- **é€šçŸ¥æ¨¡æ¿ç‰ˆæœ¬æ§åˆ¶** â€” v1.3 æ¯æ¬¡å„²å­˜è¦†è“‹èˆŠç‰ˆæœ¬,æœªä¾†å¯å¯¦ä½œç‰ˆæœ¬æ­·å²
- **LINE Flex Message æ ¼å¼** â€” v1.3 ä½¿ç”¨ç´”æ–‡å­—é€šçŸ¥,æœªä¾†å¯æ”¯æ´åœ–æ–‡è¨Šæ¯
- **Email/SMS é€šçŸ¥** â€” v1.3 åƒ…æ”¯æ´ LINE é€šçŸ¥,æœªä¾†å¯æ“´å……å…¶ä»–é€šçŸ¥ç®¡é“
- **éåŒæ­¥é€šçŸ¥è™•ç†** â€” v1.3 ä½¿ç”¨åŒæ­¥é€šçŸ¥,ç”¨æˆ¶é‡ > 10k æ™‚è€ƒæ…®å¼•å…¥ Action Scheduler

### Traceability (v1.3)

| Requirement | Phase | Status |
|-------------|-------|--------|
| DATA-01 | TBD | Pending |
| DATA-02 | TBD | Pending |
| DATA-03 | TBD | Pending |
| NOTIF-01 | TBD | Pending |
| NOTIF-02 | TBD | Pending |
| NOTIF-03 | TBD | Pending |
| NOTIF-04 | TBD | Pending |
| NOTIF-05 | TBD | Pending |
| TMPL-01 | TBD | Pending |
| TMPL-02 | TBD | Pending |
| TMPL-03 | TBD | Pending |
| TMPL-04 | TBD | Pending |
| TMPL-05 | TBD | Pending |

**Coverage:**
- v1.3 requirements: 13 total
- Mapped to phases: 0 (å¾… roadmap å»ºç«‹å¾Œæ›´æ–°)
- Unmapped: 13

---

## v1.2 Requirements (Completed)

**Milestone:** v1.2 - LINE é€šçŸ¥è§¸ç™¼æ©Ÿåˆ¶æ•´åˆ
**Completed:** 2026-02-01

### å•†å“ä¸Šæ¶é€šçŸ¥ (PROD)

- [x] **PROD-01**: ç•¶è³£å®¶é€é LINE ä¸Šæ¶å•†å“æ™‚ï¼Œè§¸ç™¼é€šçŸ¥äº‹ä»¶ â€” Phase 30
- [x] **PROD-02**: ç™¼é€é€šçŸ¥çµ¦å•†å“æ“æœ‰è€…ï¼ˆè³£å®¶ï¼‰ â€” Phase 30
- [x] **PROD-03**: ç™¼é€é€šçŸ¥çµ¦æ‰€æœ‰å·²ç¶å®š LINE çš„å°å¹«æ‰‹ â€” Phase 30

### è¨‚å–®é€šçŸ¥ (ORD)

- [x] **ORD-01**: æ–°è¨‚å–®å»ºç«‹æ™‚ï¼Œé€šçŸ¥è³£å®¶ â€” Phase 31
- [x] **ORD-02**: æ–°è¨‚å–®å»ºç«‹æ™‚ï¼Œé€šçŸ¥æ‰€æœ‰å·²ç¶å®š LINE çš„å°å¹«æ‰‹ â€” Phase 31
- [x] **ORD-03**: æ–°è¨‚å–®å»ºç«‹æ™‚ï¼Œé€šçŸ¥è²·å®¶ï¼ˆå¦‚æœè²·å®¶æœ‰ LINE ç¶å®šï¼‰ â€” Phase 31
- [x] **ORD-04**: è¨‚å–®ç‹€æ…‹è®Šæ›´æ™‚ï¼Œåƒ…é€šçŸ¥è²·å®¶ â€” Phase 31

### èº«ä»½è­˜åˆ¥ (IDENT)

- [x] **IDENT-01**: æŸ¥è©¢ LINE UID å°æ‡‰çš„ WordPress User ID â€” Phase 28
- [x] **IDENT-02**: åˆ¤æ–·ç”¨æˆ¶è§’è‰²ï¼ˆbuygo_admin = è³£å®¶ã€buygo_helper = å°å¹«æ‰‹ã€å…¶ä»– = è²·å®¶ï¼‰ â€” Phase 28
- [x] **IDENT-03**: åˆ¤æ–·ç”¨æˆ¶æ˜¯å¦æœ‰ LINE ç¶å®š â€” Phase 28

### Bot å›æ‡‰é‚è¼¯ (BOT)

- [x] **BOT-01**: è³£å®¶ç™¼é€è¨Šæ¯æ™‚ï¼Œbot æ­£å¸¸å›æ‡‰ â€” Phase 29
- [x] **BOT-02**: å°å¹«æ‰‹ç™¼é€è¨Šæ¯æ™‚ï¼Œbot æ­£å¸¸å›æ‡‰ â€” Phase 29
- [x] **BOT-03**: è²·å®¶ç™¼é€è¨Šæ¯æ™‚ï¼Œbot ä¸å›æ‡‰ï¼ˆéœé»˜ï¼‰ â€” Phase 29
- [x] **BOT-04**: æœªç¶å®šç”¨æˆ¶ç™¼é€è¨Šæ¯æ™‚ï¼Œbot ä¸å›æ‡‰ï¼ˆéœé»˜ï¼‰ â€” Phase 29

### èˆ‡ buygo-line-notify æ•´åˆ (INTEG)

- [x] **INTEG-01**: ç›£è½ buygo-line-notify ç™¼å‡ºçš„ WordPress hooks â€” Phase 28
- [x] **INTEG-02**: å‘¼å« MessagingService ç™¼é€ LINE æ¨æ’­ â€” Phase 28
- [x] **INTEG-03**: ç§»æ¤ä¸¦ä½¿ç”¨ NotificationTemplates æ¨¡æ¿ç³»çµ± â€” Phase 28

---

*Last updated: 2026-02-02 after v1.3 milestone research and requirements definition*
